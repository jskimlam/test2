<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Global SM Status | Verified 122 Sites Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --primary: #1F3044; --accent: #4FA0C1; --current: #1A1A1B; --future: #F39C12; --bg: #F8FAFC; }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Pretendard', sans-serif; overflow: hidden; }
        #layout { display: flex; height: 100vh; width: 100vw; position: relative; }
        #map { flex-grow: 1; height: 100%; background: #E2E8F0; z-index: 1; }
        #sidebar { position: absolute; left: 0; top: 0; width: 320px; height: 100%; background: white; z-index: 2000; transition: transform 0.5s ease; box-shadow: 5px 0 15px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        #sidebar.hidden { transform: translateX(-100%); }
        #toggle-btn { position: absolute; right: -45px; top: 20px; width: 45px; height: 45px; background: var(--primary); color: white; border: none; cursor: pointer; border-radius: 0 8px 8px 0; font-size: 18px; z-index: 2001; }
        .header { background: var(--primary); color: white; padding: 15px; cursor: pointer; }
        .global-cap { background: var(--accent); padding: 12px 15px; color: white; border-bottom: 2px solid rgba(0,0,0,0.05); cursor: pointer; }
        #list-container { flex-grow: 1; overflow-y: auto; background: var(--bg); }
        .group-header { padding: 10px 12px; font-weight: bold; cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.03); font-size: 0.78rem; }
        .risk-header-current { background: var(--current); color: white; }
        .risk-header-future { background: var(--future); color: white; }
        .region-header { background: #CBD5E1; color: var(--primary); }
        .country-header { background: #F1F5F9; color: #475569; padding-left: 20px; font-size: 0.75rem; }
        .collapsible-content { display: none; }
        .open > .collapsible-content { display: block; }
        .plant-card { padding: 10px 12px 10px 30px; border-bottom: 1px solid #F1F5F9; cursor: pointer; font-size: 0.72rem; background: white; position: relative; }
        .plant-card.current-risk { border-left: 6px solid var(--current); }
        .plant-card.future-risk { border-left: 6px solid var(--future); }
        .badge { font-size: 0.55rem; padding: 2px 4px; border-radius: 3px; color: white; background: var(--accent); float: right; margin-left: 5px; }
        .badge.black { background: var(--current); }
        .badge.orange { background: var(--future); }
        .loss-badge { background: #EF4444; color: white; font-weight: bold; padding: 1px 5px; border-radius: 10px; font-size: 0.58rem; position: absolute; right: 10px; top: 8px; }
        .capa-info { color: #64748B; font-size: 0.6rem; margin-top: 2px; }
    </style>
</head>
<body>
<div id="layout">
    <div id="sidebar">
        <button id="toggle-btn" onclick="document.getElementById('sidebar').classList.toggle('hidden')">üìä</button>
        <div class="header" onclick="resetToGlobal()">
            <h1 style="margin:0; font-size:0.95rem;">Global SM Dashboard</h1>
            <p style="margin:2px 0 0 0; font-size:0.7rem; color: #94A3B8; font-weight:bold;">made by LAM</p>
            <p style="margin:4px 0 0 0; font-size:0.55rem; opacity:0.6;">Verified 122 Sites | China: 21,628kt | Interactive</p>
        </div>
        <div class="global-cap" onclick="resetToGlobal()">
            <span style="font-size:0.6rem;">Global Total Capacity Tracking (100%)</span><br>
            <strong id="global-val" style="font-size:1rem;">0</strong> <small>K MT/Y</small>
        </div>
        <div id="list-container">
            <div id="current-risk-group" class="open">
                <div class="group-header risk-header-current" onclick="this.parentElement.classList.toggle('open')"><span>‚ö†Ô∏è CURRENT RISK</span><span id="current-total-header"></span></div>
                <div class="collapsible-content" id="current-risk-list"></div>
            </div>
            <div id="future-risk-group" class="open">
                <div class="group-header risk-header-future" onclick="this.parentElement.classList.toggle('open')"><span>üìÖ FUTURE MAINT</span><span id="future-total-header"></span></div>
                <div class="collapsible-content" id="future-risk-list"></div>
            </div>
            <div style="background: var(--primary); color:white; padding:8px 12px; font-size:0.72rem; font-weight:bold;">üåê CAPACITY & SHARE BY REGION</div>
            <div id="region-list"></div>
        </div>
    </div>
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    /* [ÏßÄÏπ®] 122Í∞ú Ï†ÑÏ≤¥ ÏóÖÏ≤¥ - ÏàúÏÑú ÏóÑÏàò Î∞è ÏßÄÏó≠Î≥Ñ Í≥µÎ∞± Î∂ÑÎ¶¨ */
    const plantData = [
        /* --- 1. NEA CHINA (69 lines, Sum 21,628kt) --- */
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Anhui Haoyuan Chemical", "location": "Fuyang", "capacity": 260, "lat": 32.91, "lng": 115.86, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Anhui Jiaxi New Material", "location": "Huainan", "capacity": 350, "lat": 32.78, "lng": 116.82, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Bora LyondellBasell", "location": "Panjin", "capacity": 350, "lat": 40.71, "lng": 122.12, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "China Petroleum Eng", "location": "Karamay", "capacity": 40, "lat": 45.59, "lng": 84.87, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "CSPC Huizhou L1", "location": "Huizhou", "capacity": 637, "lat": 22.75, "lng": 114.65, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "CSPC Huizhou L2", "location": "Huizhou", "capacity": 650, "lat": 22.76, "lng": 114.66, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "CNOOC Dongfang", "location": "Dongfang", "capacity": 120, "lat": 19.1, "lng": 108.65, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Cnooc Ningbo Daxie", "location": "Ningbo", "capacity": 280, "lat": 29.93, "lng": 121.95, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "CNPC/PDVSA Guangdong", "location": "Jieyang", "capacity": 800, "lat": 22.95, "lng": 116.15, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Daqing Petrochem L1", "location": "Daqing", "capacity": 100, "lat": 46.55, "lng": 125.12, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Daqing Petrochem L2", "location": "Daqing", "capacity": 125, "lat": 46.56, "lng": 125.13, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Fujian Gulei Petrochem", "location": "Zhangzhou", "capacity": 600, "lat": 23.93, "lng": 117.61, "status": "Maintenance (Future)", "days": 61, "period": "Mar 1 ~ Apr 30"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Fujian Haiquan Chemical", "location": "Zhangzhou", "capacity": 227, "lat": 23.94, "lng": 117.62, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Guangdong Xinhuayue", "location": "Maoming", "capacity": 30, "lat": 21.66, "lng": 110.92, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Guoen Chemical", "location": "Dongming", "capacity": 150, "lat": 35.29, "lng": 115.09, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Hengli Petrochemical", "location": "Dalian", "capacity": 720, "lat": 39.05, "lng": 121.35, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Hongrun Petrochemical", "location": "Weifang", "capacity": 120, "lat": 37.15, "lng": 119.15, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Lanzhou Huifeng", "location": "Lanzhou", "capacity": 25, "lat": 36.06, "lng": 103.83, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Lihuayi Lijin L1", "location": "Dongying", "capacity": 80, "lat": 37.742, "lng": 118.452, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Lihuayi Lijin L2", "location": "Dongying", "capacity": 720, "lat": 37.748, "lng": 118.462, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "New Solar Tech L1", "location": "Changzhou", "capacity": 250, "lat": 31.95, "lng": 119.98, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "New Solar Tech L2", "location": "Changzhou", "capacity": 300, "lat": 31.96, "lng": 119.99, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Ningbo Huatai Shengfu", "location": "Ningbo", "capacity": 400, "lat": 30.05, "lng": 121.65, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Ningbo Keyuan Refining", "location": "Ningbo", "capacity": 80, "lat": 30.06, "lng": 121.66, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Ningbo ZRCC Lyondell L1", "location": "Ningbo", "capacity": 620, "lat": 30.0, "lng": 121.74, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Ningbo ZRCC Lyondell L2", "location": "Ningbo", "capacity": 600, "lat": 30.01, "lng": 121.75, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Panjin Ethylene", "location": "Panjin", "capacity": 195, "lat": 41.15, "lng": 122.05, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Dushanzi", "location": "Karamay", "capacity": 360, "lat": 44.35, "lng": 84.85, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Fushun", "location": "Fushun", "capacity": 60, "lat": 41.88, "lng": 123.95, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Guangxi L1", "location": "Qinzhou", "capacity": 35, "lat": 21.95, "lng": 108.62, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Guangxi L2", "location": "Qinzhou", "capacity": 302, "lat": 21.96, "lng": 108.63, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Huabei", "location": "Renqiu", "capacity": 80, "lat": 38.7, "lng": 116.1, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Jilin L1", "location": "Jilin City", "capacity": 600, "lat": 43.85, "lng": 126.55, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Jilin L2", "location": "Jilin City", "capacity": 320, "lat": 43.86, "lng": 126.56, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Jinxi", "location": "Huludao", "capacity": 60, "lat": 40.71, "lng": 120.84, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Jinzhou", "location": "Jinzhou", "capacity": 80, "lat": 41.09, "lng": 121.12, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "PetroChina Lanzhou", "location": "Lanzhou", "capacity": 60, "lat": 36.07, "lng": 103.84, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Qingdao Haiwan Chem", "location": "Qingdao", "capacity": 500, "lat": 35.75, "lng": 119.85, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Satellite Chemical", "location": "Lianyungang", "capacity": 600, "lat": 34.55, "lng": 119.35, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shaanxi Yanchang Petroleum", "location": "Yan'an", "capacity": 120, "lat": 36.59, "lng": 109.49, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shandong Huaxing", "location": "Dongying", "capacity": 80, "lat": 37.45, "lng": 118.51, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shandong Yulong", "location": "Yantai", "capacity": 500, "lat": 37.65, "lng": 120.35, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shanghai SECCO", "location": "Jinshan", "capacity": 650, "lat": 30.74, "lng": 121.43, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shenghong Petrochem", "location": "Lianyungang", "capacity": 450, "lat": 34.54, "lng": 119.34, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Shengteng Tech", "location": "Cangzhou", "capacity": 80, "lat": 38.3, "lng": 116.85, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinochem Quanzhou", "location": "Quanzhou", "capacity": 450, "lat": 25.15, "lng": 118.95, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Anqing L1", "location": "Anqing", "capacity": 100, "lat": 30.55, "lng": 117.05, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Anqing L2", "location": "Anqing", "capacity": 400, "lat": 30.56, "lng": 117.06, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Baling Assets", "location": "Yueyang", "capacity": 120, "lat": 29.45, "lng": 113.15, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Guangzhou", "location": "Guangzhou", "capacity": 80, "lat": 23.13, "lng": 113.26, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Hainan L1", "location": "Yangpu", "capacity": 500, "lat": 19.74, "lng": 109.18, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "SINOPEC Hainan Shihua L2", "location": "Yangpu", "capacity": 80, "lat": 19.75, "lng": 109.19, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Jingmen", "location": "Jingmen", "capacity": 80, "lat": 31.03, "lng": 112.2, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Jinling", "location": "Nanjing", "capacity": 60, "lat": 32.15, "lng": 118.95, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Luoyang", "location": "Luoyang", "capacity": 120, "lat": 34.62, "lng": 112.45, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Qingdao Ref", "location": "Qingdao", "capacity": 80, "lat": 36.08, "lng": 120.39, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Sinopec Sabic Tianjin", "location": "Tianjin", "capacity": 35, "lat": 38.75, "lng": 117.65, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "SP Chemicals", "location": "Taixing", "capacity": 320, "lat": 32.16, "lng": 119.95, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Tangshan Risun Chem", "location": "Tangshan", "capacity": 300, "lat": 38.98, "lng": 118.45, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Tianjin Bohua Chem", "location": "Binhai", "capacity": 450, "lat": 38.68, "lng": 117.65, "status": "Trouble (Current)", "days": 45, "period": "Dec 25 ~ Feb 10"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Tianjin Dagu Chemical", "location": "Binhai", "capacity": 500, "lat": 38.95, "lng": 117.75, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Various_China Facilities", "location": "Nanjing", "capacity": 120, "lat": 32.05, "lng": 118.80, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Wanhua Chemical L1", "location": "Yantai", "capacity": 650, "lat": 37.55, "lng": 121.35, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Wanhua Chemical L2", "location": "Yantai", "capacity": 13, "lat": 37.56, "lng": 121.36, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "ZPC L1", "location": "Zhoushan", "capacity": 1200, "lat": 30.34, "lng": 122.15, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "ZPC L2", "location": "Zhoushan", "capacity": 600, "lat": 30.35, "lng": 122.16, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "ZPC L3", "location": "Zhoushan", "capacity": 600, "lat": 30.36, "lng": 122.17, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Zhenhua Petrochem", "location": "Dongying", "capacity": 504, "lat": 37.45, "lng": 118.55, "status": "Normal"},
        {"region": "NEA", "country": "CHINA (MAINLAND)", "company": "Zibo Juncheng Chem", "location": "Zibo", "capacity": 500, "lat": 36.81, "lng": 118.06, "status": "Normal"},

        /* --- 2. NEA JAPAN (7 lines) [cite: 69, 96, 108] --- */
        {"region": "NEA", "country": "JAPAN", "company": "Asahi Kasei Corp", "location": "Mizushima", "capacity": 390, "lat": 34.48, "lng": 133.72, "status": "Normal"},
        {"region": "NEA", "country": "JAPAN", "company": "Denka Co Ltd (Chiba SM)", "location": "Ichihara", "capacity": 270, "lat": 35.51, "lng": 140.08, "status": "Maintenance (Future)", "days": 92, "period": "Jun ~ Aug"},
        {"region": "NEA", "country": "JAPAN", "company": "Idemitsu Tokuyama L1", "location": "Shunan", "capacity": 120, "lat": 34.045, "lng": 131.81, "status": "Maintenance (Future)", "days": 92, "period": "Aug ~ Oct"},
        {"region": "NEA", "country": "JAPAN", "company": "Idemitsu Tokuyama L2", "location": "Shunan", "capacity": 220, "lat": 34.055, "lng": 131.82, "status": "Maintenance (Future)", "days": 92, "period": "Aug ~ Oct"},
        {"region": "NEA", "country": "JAPAN", "company": "NS Oita L1", "location": "Oita", "capacity": 190, "lat": 33.242, "lng": 131.662, "status": "Maintenance (Future)", "days": 75, "period": "Feb 15 ~ Apr 30"},
        {"region": "NEA", "country": "JAPAN", "company": "NS Oita L2", "location": "Oita", "capacity": 230, "lat": 33.248, "lng": 131.672, "status": "Maintenance (Future)", "days": 75, "period": "Feb 15 ~ Apr 30"},
        {"region": "NEA", "country": "JAPAN", "company": "Idemitsu Ichihara", "location": "Ichihara", "capacity": 210, "lat": 35.5, "lng": 140.095, "status": "Normal"},

        /* --- 3. NEA KOREA (5 lines, Land coordinates) [cite: 125] --- */
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "Hanwha Total L1", "location": "Daesan", "capacity": 650, "lat": 37.012, "lng": 126.415, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "Hanwha Total L2", "location": "Daesan", "capacity": 400, "lat": 37.018, "lng": 126.422, "status": "Shutdown (Current)", "days": 365, "period": "Since Oct 2025"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "Lotte Chemical (Merged)", "location": "Daesan", "capacity": 580, "lat": 37.005, "lng": 126.408, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "SK geo centric (Ulsan)", "location": "Ulsan", "capacity": 450, "lat": 35.505, "lng": 129.355, "status": "Normal"},
        {"region": "NEA", "country": "KOREA, SOUTH", "company": "YEOCHUN NCC", "location": "Yeosu", "capacity": 365, "lat": 34.825, "lng": 127.705, "status": "Normal"},

        /* --- 4. NEA TAIWAN (7 lines) [cite: 260, 311, 322] --- */
        {"region": "NEA", "country": "TAIWAN", "company": "FCFC Mailiao L1", "location": "Mailiao", "capacity": 250, "lat": 23.785, "lng": 120.182, "status": "Normal"},
        {"region": "NEA", "country": "TAIWAN", "company": "FCFC Mailiao L2", "location": "Mailiao", "capacity": 350, "lat": 23.792, "lng": 120.192, "status": "Normal"},
        {"region": "NEA", "country": "TAIWAN", "company": "FCFC Mailiao L3", "location": "Mailiao", "capacity": 720, "lat": 23.8, "lng": 120.2, "status": "Normal"},
        {"region": "NEA", "country": "TAIWAN", "company": "GPPC Line 2", "location": "Kaohsiung", "capacity": 130, "lat": 22.62, "lng": 120.31, "status": "Normal"},
        {"region": "NEA", "country": "TAIWAN", "company": "Taiwan SM L1", "location": "Lin Yuan", "capacity": 180, "lat": 22.48, "lng": 120.4, "status": "Normal"},
        {"region": "NEA", "country": "TAIWAN", "company": "Grand Pacific Line 3", "location": "Ta-She", "capacity": 250, "lat": 22.73, "lng": 120.36, "status": "Normal"},
        {"region": "NEA", "country": "TAIWAN", "company": "Taiwan SM L2", "location": "Lin Yuan", "capacity": 160, "lat": 22.49, "lng": 120.41, "status": "Normal"},

        /* --- 5. SEA (7 lines) [cite: 247] --- */
        {"region": "SEA", "country": "INDONESIA", "company": "SMI L1", "location": "Serang", "capacity": 100, "lat": -6.11, "lng": 106.15, "status": "Normal"},
        {"region": "SEA", "country": "MALAYSIA", "company": "Idemitsu SM", "location": "Pasir Gudang", "capacity": 240, "lat": 1.47, "lng": 103.89, "status": "Maintenance (Future)", "days": 45, "period": "May 1 ~ Jun 15"},
        {"region": "SEA", "country": "SINGAPORE", "company": "Aster Chemicals", "location": "Jurong Island", "capacity": 550, "lat": 1.27, "lng": 103.72, "status": "Normal"},
        {"region": "SEA", "country": "THAILAND", "company": "IRPC", "location": "Rayong", "capacity": 260, "lat": 12.68, "lng": 101.28, "status": "Normal"},
        {"region": "SEA", "country": "THAILAND", "company": "Siam SM", "location": "Rayong", "capacity": 300, "lat": 12.69, "lng": 101.29, "status": "Normal"},
        {"region": "SEA", "country": "INDONESIA", "company": "SMI L2", "location": "Serang", "capacity": 240, "lat": -6.12, "lng": 106.16, "status": "Normal"},
        {"region": "SEA", "country": "SINGAPORE", "company": "Shell Seraya", "location": "Jurong Island", "capacity": 390, "lat": 1.28, "lng": 103.73, "status": "Normal"},

        /* --- 6. Western Europe (9 lines) --- */
        {"region": "Western Europe", "country": "BELGIUM", "company": "INEOS Antwerp L1", "location": "Antwerp", "capacity": 310, "lat": 51.22, "lng": 4.4, "status": "Normal"},
        {"region": "Western Europe", "country": "BELGIUM", "company": "INEOS Antwerp L2", "location": "Antwerp", "capacity": 250, "lat": 51.23, "lng": 4.41, "status": "Normal"},
        {"region": "Western Europe", "country": "FRANCE", "company": "TotalEnergies", "location": "Gonfreville", "capacity": 630, "lat": 49.49, "lng": 0.23, "status": "Normal"},
        {"region": "Western Europe", "country": "GERMANY", "company": "BASF SE", "location": "Ludwigshafen", "capacity": 550, "lat": 49.48, "lng": 8.46, "status": "Normal"},
        {"region": "Western Europe", "country": "ITALY", "company": "Eni Rewind", "location": "Mantova", "capacity": 430, "lat": 45.16, "lng": 10.79, "status": "Normal"},
        {"region": "Western Europe", "country": "NETHERLANDS", "company": "Shell Nederland", "location": "Moerdijk", "capacity": 450, "lat": 51.69, "lng": 4.64, "status": "Normal"},
        {"region": "Western Europe", "country": "SPAIN", "company": "Repsol Quimica", "location": "Tarragona", "capacity": 490, "lat": 41.16, "lng": 1.22, "status": "Maintenance (Current)", "days": 52, "period": "Jan 15 ~ Mar 8"},
        {"region": "Western Europe", "country": "ITALY", "company": "Versalis SpA", "location": "Mantova", "capacity": 190, "lat": 45.17, "lng": 10.80, "status": "Normal"},
        {"region": "Western Europe", "country": "NETHERLANDS", "company": "Ellba C.V.", "location": "Moerdijk", "capacity": 550, "lat": 51.68, "lng": 4.63, "status": "Normal"},

        /* --- 7. Middle East (6 lines) [cite: 233, 297] --- */
        {"region": "Middle East", "country": "IRAN", "company": "Pars Petrochem", "location": "Asaluyeh", "capacity": 630, "lat": 27.48, "lng": 52.61, "status": "Normal"},
        {"region": "Middle East", "country": "IRAN", "company": "Tabriz Petrochem", "location": "Tabriz", "capacity": 95, "lat": 38.07, "lng": 46.29, "status": "Normal"},
        {"region": "Middle East", "country": "KUWAIT", "company": "Kuwait Styrene", "location": "Shuaiba", "capacity": 525, "lat": 29.04, "lng": 48.16, "status": "Trouble (Current)", "days": 65, "period": "Jan ~ Mar", "reason": "FM Declared"},
        {"region": "Middle East", "country": "SAUDI ARABIA", "company": "Petrokemya L1", "location": "Al Jubail", "capacity": 570, "lat": 27.01, "lng": 49.66, "status": "Trouble (Current)", "days": 60, "period": "Jan 15 ~ Mar 15"},
        {"region": "Middle East", "country": "SAUDI ARABIA", "company": "Petrokemya L2", "location": "Al Jubail", "capacity": 550, "lat": 27.02, "lng": 49.67, "status": "Trouble (Current)", "days": 60, "period": "Jan 15 ~ Mar 15"},
        {"region": "Middle East", "country": "SAUDI ARABIA", "company": "Jubail CP", "location": "Al Jubail", "capacity": 750, "lat": 27.03, "lng": 49.68, "status": "Normal"},

        /* --- 8. North America (9 lines) --- */
        {"region": "North America", "country": "CANADA", "company": "Shell Canada", "location": "Ft. Sask", "capacity": 450, "lat": 53.71, "lng": -113.21, "status": "Normal"},
        {"region": "North America", "country": "UNITED STATES", "company": "AmSty L1", "location": "St. James", "capacity": 500, "lat": 30.01, "lng": -90.85, "status": "Normal"},
        {"region": "North America", "country": "UNITED STATES", "company": "Cos-Mar L1", "location": "Carville", "capacity": 567, "lat": 30.22, "lng": -91.1, "status": "Trouble (Current)", "days": 90, "period": "Jan ~ Apr"},
        {"region": "North America", "country": "UNITED STATES", "company": "Cos-Mar L2", "location": "Carville", "capacity": 567, "lat": 30.23, "lng": -91.11, "status": "Trouble (Current)", "days": 90, "period": "Jan ~ Apr"},
        {"region": "North America", "country": "UNITED STATES", "company": "INEOS Pasadena", "location": "Pasadena", "capacity": 771, "lat": 29.7, "lng": -95.2, "status": "Normal"},
        {"region": "North America", "country": "UNITED STATES", "company": "PO JV L1", "location": "Channelview", "capacity": 700, "lat": 29.81, "lng": -95.12, "status": "Normal"},
        {"region": "North America", "country": "UNITED STATES", "company": "AmSty L2", "location": "St. James", "capacity": 453, "lat": 30.02, "lng": -90.86, "status": "Normal"},
        {"region": "North America", "country": "UNITED STATES", "company": "INEOS Texas City", "location": "Texas City", "capacity": 454, "lat": 29.38, "lng": -94.9, "status": "Normal"},
        {"region": "North America", "country": "UNITED STATES", "company": "PO JV L2", "location": "Channelview", "capacity": 700, "lat": 29.82, "lng": -95.13, "status": "Normal"},

        /* --- 9. South America (3 lines) --- */
        {"region": "South America", "country": "ARGENTINA", "company": "Pampa Energia SA", "location": "San Martin", "capacity": 160, "lat": -32.72, "lng": -60.73, "status": "Normal"},
        {"region": "South America", "country": "BRAZIL", "company": "CBE", "location": "Cubatao", "capacity": 120, "lat": -23.89, "lng": -46.42, "status": "Normal"},
        {"region": "South America", "country": "BRAZIL", "company": "Videolar-Innova", "location": "Triunfo", "capacity": 420, "lat": -29.94, "lng": -51.35, "status": "Normal"}
    ];

    const regionColors = { "NEA": "#A5C9CA", "SEA": "#C1D5A4", "Western Europe": "#D9CBFF", "Middle East": "#FFECC8", "North America": "#FFD1D1", "South America": "#E2E8F0" };
    const regionFlyTo = { "NEA": { c: [32, 122], z: 4 }, "SEA": { c: [5, 110], z: 5 }, "Western Europe": { c: [50, 10], z: 5 }, "Middle East": { c: [28, 50], z: 5 }, "North America": { c: [38, -95], z: 4 }, "South America": { c: [-25, -60], z: 4 } };

    const map = L.map('map', {zoomControl: false}).setView([20, 10], 2);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

    const globalTotalCapa = plantData.reduce((s, p) => s + p.capacity, 0);
    document.getElementById('global-val').innerText = globalTotalCapa.toLocaleString();

    function resetToGlobal() { map.flyTo([20, 10], 2, {duration: 2.0}); }

    function flyWithOffset(latlng, zoom) {
        const sidebar = document.getElementById('sidebar');
        const offset = sidebar.classList.contains('hidden') ? 0 : 320;
        const target = map.project(latlng, zoom).subtract([offset / 2, 0]);
        map.flyTo(map.unproject(target, zoom), zoom, { duration: 2.0 });
    }

    function calculateLoss(p) {
        if (!p.days) return 0;
        return ((p.capacity / 365) * p.days).toFixed(1);
    }

    const currentRisks = plantData.filter(p => p.status.includes('Current'));
    const futureRisks = plantData.filter(p => p.status.includes('Future'));
    const curLossSum = currentRisks.reduce((s, p) => s + parseFloat(calculateLoss(p)), 0);
    const futLossSum = futureRisks.reduce((s, p) => s + parseFloat(calculateLoss(p)), 0);
    
    document.getElementById('current-total-header').innerText = `${curLossSum.toLocaleString()}K MT Loss ‚ñº`;
    document.getElementById('future-total-header').innerText = `${futLossSum.toLocaleString()}K MT Loss ‚ñº`;

    const nested = {};
    plantData.forEach(p => {
        const isCurrent = p.status.includes('Current');
        const isFuture = p.status.includes('Future');
        let m;

        // [ÏßÄÏπ®] ÎßàÏª§ ÌÅ¨Í∏∞ 30% ÌôïÎåÄ Ï†ÅÏö©
        if (isCurrent || isFuture) {
            const riskCol = isCurrent ? '#1A1A1B' : '#F39C12';
            m = L.circleMarker([p.lat, p.lng], { 
                radius: Math.sqrt(p.capacity) * 0.59, 
                fillColor: riskCol, color: 'transparent', weight: 0, fillOpacity: 0.95 
            }).addTo(map);
        } else {
            const iconSize = Math.sqrt(p.capacity) * 0.43 * 2.5; 
            const regCol = regionColors[p.region];
            const dropletIcon = L.divIcon({
                className: 'custom-droplet',
                html: `
                <svg viewBox="0 0 24 24" width="${iconSize}" height="${iconSize}">
                    <defs>
                        <linearGradient id="g-${p.company.replace(/\W/g, '')}" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:white;stop-opacity:0.4" />
                            <stop offset="100%" style="stop-color:black;stop-opacity:0.1" />
                        </linearGradient>
                    </defs>
                    <path fill="${regCol}" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>
                    <path fill="url(#g-${p.company.replace(/\W/g, '')})" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>
                </svg>`,
                iconSize: [iconSize, iconSize], iconAnchor: [iconSize/2, iconSize]
            });
            m = L.marker([p.lat, p.lng], { icon: dropletIcon }).addTo(map);
        }
        
        // [ÏßÄÏπ®] ÏßÄÎèÑ ÎßàÏª§ ÏßÅÏ†ë ÌÅ¥Î¶≠ Ïãú ÌôïÎåÄ Í∏∞Îä• Ï∂îÍ∞Ä
        m.on('click', (e) => {
            L.DomEvent.stopPropagation(e);
            flyWithOffset([p.lat, p.lng], 9);
        });

        const lossVal = calculateLoss(p);
        const annualShare = ((p.capacity / globalTotalCapa) * 100).toFixed(2);
        let pop = `<div style="padding:5px;"><strong>${p.company}</strong><br><small>${p.location}</small><hr style="border:0;border-top:1px solid #eee;">Capa: ${p.capacity.toLocaleString()}K MT (${annualShare}%)<br>Status: ${p.status}`;
        if(p.days) pop += `<br><span style="color:#EF4444; font-weight:bold;">Loss: ${lossVal}K MT</span><br><small>Period: ${p.period}</small>`;
        pop += `</div>`;
        m.bindPopup(pop); p._m = m;

        if (!nested[p.region]) nested[p.region] = { capa: 0, countries: {} };
        if (!nested[p.region].countries[p.country]) nested[p.region].countries[p.country] = { capa: 0, plants: [] };
        nested[p.region].capa += p.capacity;
        nested[p.region].countries[p.country].capa += p.capacity;
        nested[p.region].countries[p.country].plants.push(p);
    });

    const createCard = (p) => {
        const loss = calculateLoss(p);
        const share = ((p.capacity / globalTotalCapa) * 100).toFixed(2);
        const card = document.createElement('div');
        const isRisk = p.status.includes('Current') || p.status.includes('Future');
        card.className = `plant-card ${p.status.includes('Current')?'current-risk':(p.status.includes('Future')?'future-risk':'')}`;
        const bCol = p.status.includes('Current') ? 'black' : (p.status.includes('Future') ? 'orange' : '');
        const lossBadge = isRisk ? `<span class="loss-badge">${loss}K</span>` : '';
        card.innerHTML = `${lossBadge}<span class="badge ${bCol}">${p.status.split('(')[0]}</span><b>${p.company}</b><div class="capa-info">${p.capacity.toLocaleString()}K MT | ${share}% Global | ${p.days || 0} Days Stop</div>`;
        card.onclick = (e) => { e.stopPropagation(); flyWithOffset([p.lat, p.lng], 9); setTimeout(() => p._m.openPopup(), 1800); };
        return card;
    };

    currentRisks.sort((a,b)=>b.capacity-a.capacity).forEach(p=>document.getElementById('current-risk-list').appendChild(createCard(p)));
    futureRisks.sort((a,b)=>b.capacity-a.capacity).forEach(p=>document.getElementById('future-risk-list').appendChild(createCard(p)));

    Object.entries(nested).sort((a,b)=>b[1].capa - a[1].capa).forEach(([rName, rData]) => {
        const rPct = ((rData.capa / globalTotalCapa) * 100).toFixed(1);
        const rDiv = document.createElement('div');
        rDiv.className = 'region-group';
        rDiv.innerHTML = `<div class="group-header region-header" onclick="flyWithOffset(regionFlyTo['${rName}'].c, regionFlyTo['${rName}'].z); this.parentElement.classList.toggle('open')"><span>${rName} (${rData.capa.toLocaleString()}K | ${rPct}%)</span><span>‚ñº</span></div><div class="collapsible-content"></div>`;
        const countryList = rDiv.querySelector('.collapsible-content');
        
        Object.entries(rData.countries).sort((a,b)=>b[1].capa - a[1].capa).forEach(([cName, cData]) => {
            const cPct = ((cData.capa / globalTotalCapa) * 100).toFixed(1);
            const cDiv = document.createElement('div');
            cDiv.className = 'country-item';
            cDiv.innerHTML = `<div class="group-header country-header" onclick="this.parentElement.classList.toggle('open')"><span>${cName} (${cData.capa.toLocaleString()}K | ${cPct}%)</span><span>‚ñº</span></div><div class="collapsible-content"></div>`;
            const plantList = cDiv.querySelector('.collapsible-content');
            cData.plants.forEach(p => plantList.appendChild(createCard(p)));
            countryList.appendChild(cDiv);
        });
        document.getElementById('region-list').appendChild(rDiv);
    });
</script>
</body>
</html>
